# Story 0.6: Implement Testing Infrastructure

## Status

Approved

## Story

**As a** developer  
**I want** a complete testing setup  
**so that** I can ensure code quality and prevent regressions

## Acceptance Criteria

1. Vitest configured for unit tests
2. React Testing Library set up
3. Playwright configured for E2E tests
4. Example tests created
5. Test commands added to package.json

## Tasks / Subtasks

- [ ] Task 1: Install and configure Vitest (AC: 1)
  - [ ] Install Vitest v1.6.0 and required dependencies: `npm install -D vitest @vitejs/plugin-react`
  - [ ] Create `vitest.config.ts` with proper configuration
  - [ ] Configure Vitest for React and TypeScript support
  - [ ] Set up test environment for jsdom
- [ ] Task 2: Set up React Testing Library (AC: 2)
  - [ ] Install React Testing Library: `npm install -D @testing-library/react @testing-library/user-event`
  - [ ] Configure testing utilities in `/lib/test-utils.ts`
  - [ ] Set up custom render function with providers
  - [ ] Create testing setup file for global configurations
- [ ] Task 3: Configure Playwright for E2E tests (AC: 3)
  - [ ] Install Playwright v1.45.0: `npm install -D playwright`
  - [ ] Run Playwright install: `npx playwright install`
  - [ ] Create `playwright.config.ts` with test configuration
  - [ ] Configure for testing against local dev server
- [ ] Task 4: Create test directory structure (AC: 4)
  - [ ] Create `/tests/unit/` directory for unit tests
  - [ ] Create `/tests/integration/` directory for integration tests
  - [ ] Create `/tests/e2e/` directory for end-to-end tests
  - [ ] Add example test in each directory to verify setup
- [ ] Task 5: Write example tests (AC: 4)
  - [ ] Create unit test for a utility function (e.g., cn() from utils)
  - [ ] Create integration test for a component (e.g., Button from shadcn/ui)
  - [ ] Create E2E test for login flow from Story 0.3
  - [ ] Ensure tests follow happy/unhappy path pattern [Source: architecture/11-testing-strategy.md#Happy and Unhappy Path Coverage]
- [ ] Task 6: Configure test scripts in package.json (AC: 5)
  - [ ] Add `"test": "vitest"` for running all tests
  - [ ] Add `"test:unit": "vitest run tests/unit"` for unit tests only
  - [ ] Add `"test:integration": "vitest run tests/integration"` for integration tests
  - [ ] Add `"test:e2e": "playwright test"` for E2E tests
  - [ ] Add `"test:watch": "vitest watch"` for development

## Dev Notes

### Testing Philosophy

- **TDD Approach**: Follow Red-Green-Refactor cycle
- **Testing Pyramid**: "Write tests. Not too many. Mostly integration." - Kent C. Dodds
- **Coverage**: Both happy and unhappy paths must be tested
  [Source: architecture/11-testing-strategy.md#Testing Philosophy]

### Technology Stack

- **Vitest**: v1.6.0 - Modern, fast test runner with in-memory mocking
- **React Testing Library**: For testing React components
- **Playwright**: v1.45.0 - For E2E browser automation
- **Mock Service Worker (MSW)**: For mocking external services
  [Source: architecture/2-tech-stack.md]

### Test Organization

```
/tests
├── /unit/              # Pure business logic tests
├── /integration/       # Component and API route tests
└── /e2e/               # Full user flow tests
```

[Source: architecture/11-testing-strategy.md#Test Types and Organization]

### Integration Test Example Structure

```tsx
describe("POST /api/roadmaps", () => {
  // --- Happy Path ---
  it("should create a roadmap and return 201 for an authenticated user with a valid goal", () => {
    // Test logic here
  });

  // --- Unhappy Paths ---
  it("should return 401 Unauthorized if no user is logged in", () => {
    // Test logic here
  });

  it("should return 400 Bad Request if the goalDescription is missing or too short", () => {
    // Test logic here
  });
});
```

[Source: architecture/11-testing-strategy.md#Test Case Structure]

### Sandboxed Test Environment Requirements

- Mock all external services (Stripe, Notifications, AI)
- Use separate test database with `.env.test`
- Never use real API keys or credentials in tests
- Vitest's mocking for backend, MSW for frontend
  [Source: architecture/11-testing-strategy.md#Sandboxed Test Environment]

### E2E Test Coverage for V1

Two critical flows must have E2E tests:

1. Complete User Registration & First Roadmap Creation flow
2. Full "Learn, Plan, Act, Reflect" loop for a single roadmap step
   [Source: architecture/11-testing-strategy.md#End-to-End (E2E) Tests]

### Test File Naming Convention

- All test files must use `*.test.ts` or `*.test.tsx` extension
- Match component/function names (e.g., `Button.test.tsx` for `Button.tsx`)
  [Source: architecture/12-coding-standards.md#Naming Conventions]

### Previous Story Context

- Story 0.1: TypeScript and ESLint configured
- Story 0.2: shadcn/ui components available for testing
- Story 0.3: Authentication flow ready for E2E testing
- Story 0.5: CI pipeline will run these tests

### File Locations

- `/vitest.config.ts` - Vitest configuration
- `/playwright.config.ts` - Playwright configuration
- `/lib/test-utils.ts` - Testing utilities
- `/tests/` - All test files
- `/.env.test` - Test environment variables (never commit)
  [Source: architecture/10-unified-project-structure.md]

### Testing Requirements

- Every new feature must have tests
- Tests must cover both success and failure scenarios
- Integration tests prioritized over unit tests
- Mocked services for all external dependencies
- Tests run in CI pipeline from Story 0.5
  [Source: architecture/11-testing-strategy.md]

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-07-30 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
