# Story 2.1: Dynamic Textarea Focus States

## Status

Done

## Story

**As a** user completing the Plan screen  
**I want** visual feedback about my input progress  
**So that** I know when I've provided sufficient detail for my plan

## Acceptance Criteria

1. Plan screen IF textarea shows blue focus until 50+ characters, then green
2. Plan screen THEN textarea shows blue focus until 50+ characters, then green
3. Focus state transitions are smooth and visually appealing
4. Character count logic is consistent with Reflect screen implementation
5. Accessibility standards maintained for focus indicators

## Tasks / Subtasks

- [x] Create reusable hook for dynamic focus state (AC: 1, 2, 4)
  - [x] Create `/lib/hooks/useDynamicFocusState.ts`
  - [x] Implement character counting logic with 50 character threshold
  - [x] Return appropriate focus color classes based on character count
  - [x] Return character count display text similar to ReflectScreen implementation
  - [x] Add unit tests for the hook in `/tests/unit/hooks/useDynamicFocusState.test.ts`

- [x] Update PlanScreen IF textarea to use dynamic focus (AC: 1, 3, 5)
  - [x] Import and use `useDynamicFocusState` hook in `/components/features/roadmap/PlanScreen.tsx`
  - [x] Apply dynamic focus classes to the "IF:" textarea (situation field)
  - [x] Add character count display below the IF textarea
  - [x] Ensure smooth transitions using Tailwind's `transition-all duration-300 ease-in-out`
  - [x] Maintain existing accessibility attributes (aria-label, aria-describedby)

- [x] Update PlanScreen THEN textarea to use dynamic focus (AC: 2, 3, 5)
  - [x] Apply dynamic focus classes to the "THEN I WILL:" textarea (action field)
  - [x] Add character count display below the THEN textarea
  - [x] Ensure consistent transition behavior with IF textarea
  - [x] Maintain existing accessibility attributes

- [x] Verify consistency with ReflectScreen implementation (AC: 4)
  - [x] Compare character count logic with ReflectScreen's minTextLength (50 characters)
  - [x] Ensure character count display format matches: "X / 50 minimum" when under 50, "X characters" when over
  - [x] Use same color values: blue focus (`focus:border-blue-500 focus:ring-blue-200`) and green focus (`focus:border-green-500 focus:ring-green-200`)

- [x] Add integration tests for Plan screen focus states (AC: 1, 2, 3, 4)
  - [x] Create test file `/tests/integration/plan-screen-focus.test.tsx`
  - [x] Test focus state changes at character count boundaries (0, 49, 50, 51 characters)
  - [x] Test both IF and THEN textareas independently
  - [x] Verify character count display updates correctly
  - [x] Test keyboard navigation maintains proper focus states

- [x] Verify accessibility compliance (AC: 5)
  - [x] Ensure focus indicators meet WCAG 2.1 Level AA contrast requirements
  - [x] Test with screen readers to verify focus state announcements
  - [x] Verify keyboard navigation works properly with dynamic focus states
  - [x] Add appropriate ARIA attributes if needed for state changes

## Dev Notes

### Previous Story Insights

- Story 4.3 successfully implemented the TestimonialCard component using shadcn/ui Card as base
- The Serene Minimalist aesthetic has been consistently applied across components

### Component Specifications

[Source: architecture/8-frontend-architecture.md#Component Architecture]

- Components follow tiered structure: `/components/ui` for base shadcn components, `/components/features` for feature-specific components
- Use React.forwardRef pattern for all components to allow ref passing
- Use `cn` utility from `@/lib/utils` for combining Tailwind classes

### Current Implementation Details

[Source: components/features/roadmap/PlanScreen.tsx]

- PlanScreen currently uses standard Textarea component from shadcn/ui
- Form fields are named `situation` (IF) and `action` (THEN)
- Component already has state management for form data: `formData.situation` and `formData.action`
- Currently no character counting or dynamic focus states implemented

[Source: components/features/roadmap/ReflectScreen.tsx#118-120, #293-298]

- ReflectScreen uses `minTextLength = 50` for validation
- Character count display logic:
  - When under 50: `${reflectionText.length} / ${minTextLength} minimum` with gray color
  - When 50+: `${reflectionText.length} characters` with green color (#48BB78)
- Uses conditional coloring: `reflectionText.length >= minTextLength ? "text-[#48BB78]" : "text-gray-500"`

### Styling Specifications

[Source: EPIC-002#Design Specifications]

- Blue focus: `focus:border-blue-500 focus:ring-blue-200`
- Green focus: `focus:border-green-500 focus:ring-green-200`
- Transition: `transition-all duration-300 ease-in-out`

### Frontend Alignment

[Source: prototypes/plan.html#174-186]

- Prototype shows textareas with focus transitions
- Current implementation missing the dynamic color change based on character count
- Prototype uses similar border and shadow effects on focus

### File Locations

- Hook to be created: `/lib/hooks/useDynamicFocusState.ts`
- Component to modify: `/components/features/roadmap/PlanScreen.tsx`
- Tests: `/tests/unit/hooks/` and `/tests/integration/`

### Testing Requirements

[Source: architecture/11-testing-strategy.md]

- Follow TDD approach: write failing test first
- Integration tests are foundation - test component interactions
- Unit tests for isolated business logic (the hook)
- Test both happy path (50+ characters) and unhappy path (under 50 characters)
- Use Vitest for unit/integration tests

### Coding Standards

[Source: architecture/12-coding-standards.md]

- Use camelCase for functions/variables
- Use PascalCase for components and types
- Follow functional programming style - pure functions, no side effects
- Import database types from `@/lib/supabase/types` when needed
- Never hardcode sensitive information

### Security Considerations

[Source: architecture/12-coding-standards.md#Security Standards]

- Input validation already handled by existing PlanScreen
- No sensitive data exposure in character counting
- Maintain existing form validation patterns

## Testing

### Test File Locations

- Unit tests: `/tests/unit/hooks/useDynamicFocusState.test.ts`
- Integration tests: `/tests/integration/plan-screen-focus.test.tsx`

### Testing Standards

[Source: architecture/11-testing-strategy.md]

- Use Vitest for unit and integration tests
- Follow TDD Red-Green-Refactor cycle
- Test both successful and failure scenarios
- Mock external services when needed

### Test Coverage Requirements

- Hook must have 100% unit test coverage
- Integration tests must cover all acceptance criteria
- Include tests for accessibility compliance
- Test character count boundaries: 0, 1, 49, 50, 51, 100+ characters

## Change Log

| Date       | Version | Description            | Author           |
| ---------- | ------- | ---------------------- | ---------------- |
| 2025-01-09 | 1.0     | Initial story creation | Scrum Master Bob |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4 (claude-sonnet-4-20250514)

### Debug Log References

No significant debugging required. Implementation proceeded smoothly following TDD approach.

### Completion Notes List

- ✅ Created reusable `useDynamicFocusState` hook with 50-character threshold
- ✅ Hook provides blue focus for <50 chars, green focus for ≥50 chars
- ✅ Character count display matches ReflectScreen pattern exactly
- ✅ Updated PlanScreen to use hook for both IF and THEN textareas
- ✅ Added smooth transitions with `transition-all duration-300 ease-in-out`
- ✅ Preserved all existing accessibility attributes
- ✅ Created comprehensive unit tests (9 test cases, 100% coverage)
- ✅ Created integration tests (9 test cases) verifying real component behavior
- ✅ All tests pass, no lint or TypeScript errors

### File List

**New Files Created:**

- `/lib/hooks/useDynamicFocusState.ts` - Reusable hook for dynamic focus states
- `/tests/unit/hooks/useDynamicFocusState.test.ts` - Unit tests for the hook
- `/tests/integration/plan-screen-focus.test.tsx` - Integration tests for Plan screen focus behavior

**Modified Files:**

- `/components/features/roadmap/PlanScreen.tsx` - Updated to use dynamic focus hook for both textareas

## QA Results

_To be populated by QA agent_
