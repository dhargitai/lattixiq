# Story 8.2: Add Post-Plan Application Modal

## Story Overview

**Story ID:** 8.2
**Epic:** Epic 8 - UI/UX Refinements & Polish
**Priority:** P0 - Must Have
**Size:** 3 points
**Status:** Done
**Sprint:** TBD

## Story Description

### User Story

**As a** user who just saved a plan  
**I want** to receive guidance to go offline and apply what I learned  
**So that** I understand the next step in my learning journey

### Problem Statement

After users save their plan in the Plan screen, there's no clear guidance about what to do next. Users may not understand that they should now go offline, apply the mental model/bias/fallacy in real life, and return later to reflect. This creates a gap in the learning loop and may lead to users not completing the application phase properly.

### Solution

Display an informative modal immediately after a plan is successfully saved, encouraging users to go offline and apply their learning. The modal should be encouraging, clear about next steps, and appear only once per plan.

## Acceptance Criteria

- [x] Modal appears immediately after successful plan save
- [x] Modal displays encouraging message about offline application
- [x] Clear explanation of applying the learned model/bias/fallacy
- [x] Single dismissal button ("Got it!")
- [x] Modal only appears once per plan (not on subsequent views)
- [x] Mobile-responsive design
- [x] Smooth animation on appear/dismiss
- [x] Modal prevents interaction with background content

## Technical Requirements

### New Component

**File:** `/components/modals/ApplicationGuidanceModal.tsx`

```typescript
interface ApplicationGuidanceModalProps {
  isOpen: boolean;
  onClose: () => void;
  conceptType: "model" | "bias" | "fallacy";
  conceptName?: string;
}
```

### Modal Content Structure

```typescript
const modalContent = {
  title: "Time to Apply What You've Learned! ðŸŽ¯",
  body: `Great plan! Now it's time to put it into action. 
         Go offline and work on applying this ${conceptType} in real life. 
         Come back when you have some experience to reflect on.`,
  cta: "Got it!",
};
```

### Integration Points

1. **Plan Save Handler:** `/app/(app)/plan/[stepId]/page.tsx`
   - Add modal state management
   - Trigger modal on successful save
   - Track if modal has been shown

2. **State Management:**
   - Use local state or localStorage to track shown status
   - Key: `plan-modal-shown-${stepId}`

### Implementation Example

```typescript
// In Plan page component
const [showApplicationModal, setShowApplicationModal] = useState(false);

const handlePlanSave = async (planData) => {
  try {
    await savePlan(planData);

    // Check if modal has been shown before
    const modalShownKey = `plan-modal-shown-${stepId}`;
    const hasShownModal = localStorage.getItem(modalShownKey);

    if (!hasShownModal) {
      setShowApplicationModal(true);
      localStorage.setItem(modalShownKey, "true");
    } else {
      // Navigate directly to next step
      router.push(`/roadmap/${roadmapId}`);
    }
  } catch (error) {
    // Handle error
  }
};

const handleModalClose = () => {
  setShowApplicationModal(false);
  router.push(`/roadmap/${roadmapId}`);
};
```

## Design Specifications

### Modal Design

- **Max Width:** 500px
- **Padding:** 24px
- **Border Radius:** 12px
- **Backdrop:** Dark overlay (opacity: 0.5)
- **Animation:** Fade in (200ms)

### Typography

- **Title:** text-xl font-semibold
- **Body:** text-base text-gray-600
- **Button:** Primary button style, full width on mobile

### Mobile Responsive

- **Mobile:** Full width with 16px margin
- **Tablet+:** Centered with max-width

## Testing Requirements

### Unit Tests

1. Modal renders with correct content
2. Modal appears on first save
3. Modal doesn't appear on subsequent saves
4. Close button works correctly
5. LocalStorage properly tracks shown status

### Integration Tests

1. Full flow: Save plan â†’ See modal â†’ Dismiss â†’ Navigate
2. Refresh handling: Modal state persists
3. Multiple plans: Each plan gets its own modal once

### Manual Testing

1. Test on various screen sizes
2. Verify animation smoothness
3. Check keyboard navigation (ESC to close)
4. Test with different concept types

## Dependencies

- Existing modal system/components
- Plan save functionality
- Router for navigation
- LocalStorage for persistence

## Analytics Tracking

Track the following events:

1. `application_modal_shown` - When modal appears
2. `application_modal_dismissed` - When user clicks "Got it"
3. `application_modal_time` - Time spent viewing modal

## Definition of Done

- [x] Modal component created and styled
- [x] Integration with plan save flow complete
- [x] "Show once" logic implemented
- [x] Mobile responsive design verified
- [x] All tests passing
- [ ] Analytics tracking implemented
- [x] Accessibility requirements met (ARIA labels, keyboard nav)
- [ ] Code reviewed and approved
- [ ] Deployed to staging

## Future Enhancements

- A/B test different modal messages
- Add optional "Don't show again" checkbox
- Include estimated time for application phase
- Add tips for successful application

## Notes

- Consider edge case: What if user clears localStorage?
- May want to show different messages based on concept difficulty
- Could add celebration animation to modal appearance

## Dev Agent Record

### Agent Model Used

Claude Opus 4.1

### File List

- `/components/modals/ApplicationGuidanceModal.tsx` (created)
- `/components/features/roadmap/PlanScreen.tsx` (modified)
- `/tests/unit/modals/ApplicationGuidanceModal.test.tsx` (created)
- `/tests/integration/plan-modal-flow.test.tsx` (created)

### Change Log

1. Created ApplicationGuidanceModal component with Dialog from shadcn/ui
2. Integrated modal into PlanScreen component with localStorage tracking
3. Added state management for modal visibility
4. Created comprehensive unit tests for modal component
5. Created integration tests for full modal flow
6. Fixed TypeScript types to match database schema (cognitive-bias instead of bias)

### Completion Notes

- Modal successfully displays after first plan save
- localStorage tracking prevents modal from showing twice for same step
- Modal includes dynamic content based on concept type (mental-model, cognitive-bias, fallacy)
- Tests cover all acceptance criteria
- Accessibility requirements met with proper ARIA attributes
- Analytics tracking not implemented (marked as future work)

---

_Story Owner: Development Team_
_Created: 2025-08-07_
_Last Updated: 2025-08-08_
