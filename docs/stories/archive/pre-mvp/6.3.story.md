# Story 6.3: Billing Section - MVP

## Status

Done

## Story

**As a** user,
**I want** to access my billing information
**so that** I can manage my subscription

## Acceptance Criteria

1. Show current plan status (Free or Premium)
2. If Premium: Link to Stripe customer portal (external)
3. If Free: Link to internal /pricing page
4. Clear visual distinction between plan types
5. Plan badge styling per prototype

## Tasks / Subtasks

- [x] Create billing section UI (AC: 1, 4, 5)
  - [x] Add billing section to settings page
  - [x] Display current plan status
  - [x] Create plan badge component
  - [x] Match prototype styling
- [x] Implement plan badge (AC: 1, 4, 5)
  - [x] Free plan: Gray background (#F7FAFC)
  - [x] Premium plan: Gold gradient background
  - [x] Proper text styling and padding
  - [x] Rounded corners (16px radius)
- [x] Add navigation logic (AC: 2, 3)
  - [x] Check user's subscription status
  - [x] If Premium: Prepare Stripe portal URL (placeholder)
  - [x] If Free: Link to /pricing route
  - [x] Add appropriate click handlers
- [x] Style billing row (AC: 4, 5)
  - [x] White card with border
  - [x] Label: "Subscription"
  - [x] Show plan badge on right
  - [x] Add chevron icon for navigation
- [x] Handle loading states (AC: 1)
  - [x] Show skeleton while loading plan
  - [x] Handle error states gracefully
  - [x] Default to "Free" if data unavailable
- [x] Write tests (AC: 1, 2, 3)
  - [x] Test plan display logic
  - [x] Test navigation behavior
  - [x] Test badge styling

## Dev Notes

### Data Models

User subscription data:

```typescript
interface UserAccount {
  subscription: {
    status: "free" | "premium";
    stripeCustomerId?: string;
  };
}
```

[Source: epic-6-settings-preferences.md#data-model]

### Component Specifications

From prototype:

- Plan badge for Free: Background #F7FAFC, text #4A5568
- Plan badge for Premium: Gradient background (gold), darker text
- Badge styling: padding 4px 12px, border-radius 16px
- Font: 14px, weight 600
  [Source: prototypes/settings.html#plan-badge]

### File Locations

- Component: `/components/settings/BillingSection.tsx`
- Integrate into: `/app/(app)/settings/page.tsx`
  [Source: architecture/10-unified-project-structure.md]

### Technical Constraints

- Stripe portal URL generation will be added later
- For now, use placeholder URL or disabled state
- /pricing page will be created in separate epic
  [Source: epic-6-settings-preferences.md#open-questions]

## Testing

### Testing Standards

- Test file: `/tests/unit/settings/billing-section.test.tsx`
- Mock user subscription data
- Test both free and premium states
  [Source: architecture/12-coding-standards.md#testing-standards]

## Change Log

| Date       | Version | Description                | Author       |
| ---------- | ------- | -------------------------- | ------------ |
| 2025-08-06 | 1.0     | Initial MVP story creation | Scrum Master |
| 2025-08-06 | 1.1     | Completed implementation   | Dev Agent    |

## Dev Agent Record

### Agent Model Used

Claude Opus 4.1 (claude-opus-4-1-20250805)

### Debug Log References

No errors encountered during implementation.

### Completion Notes List

- Created BillingSection component with proper free/premium badge styling
- Implemented navigation logic to route to /pricing for free users
- Added placeholder for Stripe customer portal navigation for premium users
- Included loading states with skeleton UI
- Added comprehensive test coverage for all scenarios
- Component defaults to "Free" plan when subscription status is unavailable

### File List

- `/components/settings/BillingSection.tsx` - New billing section component
- `/components/settings/SettingsPageContent.tsx` - Modified to integrate BillingSection
- `/app/(app)/settings/page.tsx` - Modified to fetch stripe_customer_id
- `/tests/unit/settings/billing-section.test.tsx` - New test file with comprehensive coverage

## QA Results

_To be filled by QA Agent_
