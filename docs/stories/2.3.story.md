# Story 2.3: Create Plan Screen for Spotting Missions (Biases)

## Status

Draft

## Story

**As a** user learning about a bias  
**I want** to create a mission to spot it  
**So that** I become aware of it in real life

## Acceptance Criteria

1. Different form for bias spotting
2. Captures: where to look, what to watch for
3. Examples specific to bias detection
4. Shares reminder system with mental models
5. Clear differentiation from implementation intentions

## Tasks / Subtasks

- [ ] Task 1: Review existing PlanScreen implementation (AC: 1, 2, 3, 5)
  - [ ] Verify bias-specific form fields are functioning correctly
  - [ ] Confirm conditional rendering based on content type
  - [ ] Check that bias-specific labels and placeholders are displayed
- [ ] Task 2: Enhance bias-specific functionality if needed (AC: 1, 2, 3)
  - [ ] Review current implementation in `/components/features/roadmap/PlanScreen.tsx`
  - [ ] Verify field labels for biases:
    - Situation: "Where might you encounter this bias?"
    - Trigger: "What signs will you look for?"
    - Action: "How will you respond when you spot it?"
  - [ ] Ensure placeholder text provides clear guidance for bias spotting
- [ ] Task 3: Verify goal examples integration for biases (AC: 3)
  - [ ] Confirm `spotting_mission_example` field is displayed for biases
  - [ ] Test expandable example card functionality
  - [ ] Verify correct example type is shown based on content type
- [ ] Task 4: Test reminder system integration (AC: 4)
  - [ ] Verify plan data saves correctly for bias spotting missions
  - [ ] Confirm all plan fields are stored in database
  - [ ] Test navigation back to roadmap after saving
- [ ] Task 5: Write integration tests for bias-specific functionality (AC: 1-5)
  - [ ] Add tests to verify bias form variant displays correctly
  - [ ] Test form submission for bias spotting missions
  - [ ] Verify correct example display for biases
  - [ ] Test validation and error handling

## Dev Notes

### Previous Story Insights

From Story 2.2 implementation:

- PlanScreen component already supports conditional rendering for mental models vs biases
- Form uses different labels and placeholders based on `knowledgeContent.type`
- Goal examples integration is working with expandable cards
- Form submission saves plan data to `roadmap_steps` table
- Navigation flow: Learn → Plan → Roadmap

### Current Implementation Status

The PlanScreen component (located at `/components/features/roadmap/PlanScreen.tsx`) already implements the bias-specific functionality:

```typescript
// Conditional rendering based on content type
const contentType = knowledgeContent.type;
const isMentalModel = contentType === "mental-model";

// Different labels for biases
if (!isMentalModel) {
  return {
    situation: "Where might you encounter this bias?",
    situationPlaceholder: "Describe situations where this bias might appear",
    trigger: "What signs will you look for?",
    triggerPlaceholder: "What specific signs or patterns will you watch for?",
    action: "How will you respond when you spot it?",
    actionPlaceholder: "What will you do when you notice this bias?",
  };
}
```

[Source: components/features/roadmap/PlanScreen.tsx:lines 96-103]

### Data Models

**Knowledge Content Types:**

```typescript
type KnowledgeContentType = "mental-model" | "cognitive-bias" | "fallacy";
```

[Source: architecture/3-data-models.md#KnowledgeContent]

**Goal Examples Structure:**

```typescript
type GoalExample = {
  id: string;
  knowledge_content_id: string;
  goal: string;
  if_then_example: string | null; // For mental models
  spotting_mission_example: string | null; // For biases/fallacies
};
```

[Source: architecture/3-data-models.md#GoalExample]

### File Locations

- **Component**: `/components/features/roadmap/PlanScreen.tsx` - Already exists with bias support
- **Tests**: `/app/(app)/plan/__tests__/plan.test.tsx` - May need additional bias-specific tests
- **Route**: `/app/(app)/plan/[stepId]/page.tsx` - Already handles both content types

### Technical Constraints

- Next.js 15.4.5 with App Router
- React 19.1.0
- TypeScript with strict mode
- Tailwind CSS v4.0.0
- shadcn/ui v2.0.0 components

[Source: architecture/2-tech-stack.md#Frontend Stack]

### Testing

Following Testing Strategy:

- **Integration Tests**: Focus on testing bias-specific form interactions
- **Test Location**: `/app/(app)/plan/__tests__/plan.test.tsx`
- Verify conditional rendering based on content type
- Test form submission with bias-specific data
- Mock Supabase API calls

[Source: architecture/11-testing-strategy.md#Testing Strategy]

### Implementation Note

**IMPORTANT**: This story's functionality has already been implemented in Story 2.2. The PlanScreen component was built with conditional rendering that supports both mental models and cognitive biases/fallacies. This story should focus on:

1. Verifying the existing implementation meets all acceptance criteria
2. Adding any missing bias-specific enhancements
3. Ensuring comprehensive test coverage for the bias variant
4. Potentially refactoring if the current implementation needs improvement

## Change Log

| Date       | Version | Description      | Author             |
| ---------- | ------- | ---------------- | ------------------ |
| 2025-08-03 | 1.0     | Initial creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
