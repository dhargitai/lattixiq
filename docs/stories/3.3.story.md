# Story 3.3: Create Learned Models Library

## Status

**Status:** Post-MVP (Postponed)  
**Note:** This full-featured library is postponed. See `epic-unlocked-knowledge-viewer-mvp.md` for the simplified MVP version.

## Story

**As a** user  
**I want** to review models I've learned  
**So that** I can refresh my memory and reapply them

## Acceptance Criteria

1. Grid/list view of all completed models
2. Each shows name, category, effectiveness rating
3. Search and filter capabilities
4. Click to view full content and reflection
5. Sort by date, effectiveness, or category
6. Export or share functionality

## Tasks / Subtasks

- [ ] **Task 1: Create learned models page structure** (AC: 1, 2)
  - [ ] Create `/app/(app)/toolkit/learned/page.tsx` with layout
  - [ ] Implement loading and error states
  - [ ] Add SEO metadata and page title

- [ ] **Task 2: Build model/bias card component** (AC: 2)
  - [ ] Create `/components/features/toolkit/ModelCard.tsx`
  - [ ] Display model name, type (mental model vs bias), and category
  - [ ] Show effectiveness rating with star component
  - [ ] Add date learned timestamp
  - [ ] Implement hover states and click handler

- [ ] **Task 3: Implement filter bar component** (AC: 3)
  - [ ] Create `/components/features/toolkit/ModelFilterBar.tsx`
  - [ ] Add search input with debouncing
  - [ ] Create category filter dropdown (all categories from mental models)
  - [ ] Add type filter toggle (Mental Models / Cognitive Biases / All)
  - [ ] Add effectiveness rating filter (1-5 stars)
  - [ ] Implement clear filters button

- [ ] **Task 4: Add view toggle** (AC: 1)
  - [ ] Create grid/list view toggle component
  - [ ] Implement grid view with responsive columns (mobile: 1, tablet: 2, desktop: 3-4)
  - [ ] Implement list view with expanded information
  - [ ] Persist view preference in localStorage

- [ ] **Task 5: Create detail modal** (AC: 4)
  - [ ] Create `/components/features/toolkit/ModelDetailModal.tsx`
  - [ ] Display full model content from original learning
  - [ ] Show user's plan for applying the model
  - [ ] Display reflection and effectiveness rating
  - [ ] Add close button and backdrop click to close

- [ ] **Task 6: Implement data fetching with pagination** (AC: 1, 3)
  - [ ] Create API endpoint `/app/api/toolkit/learned/route.ts`
  - [ ] Fetch completed roadmap steps with reflections
  - [ ] Implement pagination (12 items per page)
  - [ ] Add filtering logic server-side
  - [ ] Include search functionality using PostgreSQL full-text search

- [ ] **Task 7: Add sorting functionality** (AC: 5)
  - [ ] Create sort dropdown component
  - [ ] Implement sort options: Date Learned (newest/oldest), Effectiveness (high/low), Name (A-Z/Z-A)
  - [ ] Update API to handle sort parameters
  - [ ] Maintain sort state in URL query params

- [ ] **Task 8: Implement share/export functionality** (AC: 6)
  - [ ] Add share button to model cards and detail modal
  - [ ] Create shareable link generation (public model view)
  - [ ] Implement copy to clipboard for share links
  - [ ] Add export to markdown functionality
  - [ ] Create PDF export using browser print styles

- [ ] **Task 9: Add empty states** (AC: 1, 3)
  - [ ] Create empty state for no learned models
  - [ ] Create "no results" state for filters/search
  - [ ] Add helpful CTAs (e.g., "Start a roadmap" button)

- [ ] **Task 10: Write tests** (AC: all)
  - [ ] Write integration tests for the learned models page
  - [ ] Test filtering and search functionality
  - [ ] Test pagination and sorting
  - [ ] Test modal opening and closing
  - [ ] Test export functionality

## Dev Notes

### Relevant Source Tree

- Page location: `/app/(app)/toolkit/learned/page.tsx`
- Components: `/components/features/toolkit/`
  - `ModelCard.tsx` - Individual model display card
  - `ModelFilterBar.tsx` - Search and filter controls
  - `ModelDetailModal.tsx` - Full content modal
- API endpoint: `/app/api/toolkit/learned/route.ts`
- Types: Should extend existing types from `/lib/types/`

### Data Model

The learned models are derived from completed roadmap steps that have reflections. Each model should include:

- Original mental model or bias information
- User's plan (from Plan step)
- User's reflection (from Reflect step)
- Effectiveness rating (1-5 stars from reflection)
- Completion timestamp
- Associated roadmap ID and step number

### UI Patterns

- Follow existing card patterns from `ActiveRoadmapCard.tsx`
- Use shadcn/ui components: Card, Input, Button, Dialog, Badge, Toggle, Select
- Maintain consistent spacing and typography with existing toolkit pages
- Mobile-first responsive design
- Use Tailwind CSS v4 with CSS variables

### State Management

- Use URL query params for filters, search, sort, and pagination
- Store view preference (grid/list) in localStorage
- Use React Query or SWR for data fetching and caching

### Performance Considerations

- Implement virtual scrolling if item count exceeds 50
- Lazy load modal content
- Debounce search input (300ms)
- Cache API responses client-side

### Testing Standards

From Architecture Document (Section 11 - Testing Strategy):

- **Test file location**: `/tests/integration/toolkit/learned-models.test.tsx`
- **Test framework**: Vitest with React Testing Library
- **Required test coverage**:
  - Happy path: Successfully loading and displaying learned models
  - Search functionality with results
  - Filter combinations
  - Sorting options
  - Modal interactions
  - Export functionality
  - Unhappy paths: No models, network errors, invalid filters
- **Mock requirements**: Mock Supabase queries, use MSW for API mocking
- **Test database**: Use separate test database, never production data

## Change Log

| Date       | Version | Description            | Author   |
| ---------- | ------- | ---------------------- | -------- |
| 2025-08-06 | 1.0     | Initial story creation | Bob (SM) |

## Dev Agent Record

### Agent Model Used

_To be populated by dev agent_

### Debug Log References

_To be populated by dev agent_

### Completion Notes List

_To be populated by dev agent_

### File List

_To be populated by dev agent_

## QA Results

_To be populated by QA agent_
