# Story 3.8: Create Navigation and Information Architecture

## Status

**Status:** Ready for Review

## Story

**As a** user  
**I want** consistent navigation  
**So that** I can easily move between sections

## Acceptance Criteria

1. Bottom navigation visible on all screens (except for New Roadmap/Learn/Plan/Reflect screens)
2. Clear active states for current page
3. Settings access from navigation
4. Consistent navigation behavior across all screens
5. Navigation responsive across mobile, tablet, and desktop
6. Route persistence maintained when navigating
7. Navigation animations for smooth transitions

## Tasks / Subtasks

- [x] **Task 1: Review and enhance existing BottomNav component** (AC: 1, 2, 5)
  - [x] Review existing `/components/features/shared/BottomNav.tsx`
  - [x] Ensure active states properly highlight current route
  - [x] Verify responsive behavior across breakpoints
  - [x] Add smooth transition animations for active state changes
        [Source: components/features/shared/BottomNav.tsx already exists]

- [x] **Task 2: Create navigation visibility logic** (AC: 1)
  - [x] Create a helper function to determine if bottom nav should be shown
  - [x] Hide navigation on New Roadmap (`/new-roadmap`), Learn (`/learn/*`), Plan (`/plan/*`), and Reflect (`/reflect/*`) routes
  - [x] Show navigation on all other routes
        [Source: frontend-spec.md - Learn/Plan/Reflect are focused screens without navigation]

- [x] **Task 3: Implement navigation in app layouts** (AC: 1, 4)
  - [x] Add BottomNav to main app layout for (app) route group
  - [x] Ensure navigation is not rendered in (auth) route group
  - [x] Add padding-bottom to account for fixed bottom navigation
  - [x] Test navigation visibility across all routes
        [Source: architecture/10-unified-project-structure.md - (app) and (auth) route groups]

- [x] **Task 4: Update navigation structure and routes** (AC: 2, 3, 6)
  - [x] Ensure navigation links to `/toolkit` for My Toolkit
  - [x] Ensure navigation links to `/settings` for Settings
  - [x] Add proper active state detection using `usePathname`
  - [x] Test route persistence when navigating between sections
        [Source: architecture/8-frontend-architecture.md#routing-architecture]

- [x] **Task 5: Add navigation animations and polish** (AC: 7)
  - [x] Add transition effects for active state indicator
  - [x] Implement hover states for navigation items
  - [x] Add subtle shadow/elevation for bottom navigation bar
  - [x] Ensure smooth animations don't impact performance
        [Source: frontend-spec.md - "Serene Minimalist" aesthetic with subtle animations]

- [x] **Task 6: Handle edge cases and mobile considerations** (AC: 5)
  - [x] Test on various mobile devices and screen sizes
  - [x] Ensure navigation doesn't overlap with system UI (safe areas)
  - [x] Handle keyboard appearance on mobile (navigation should hide)
  - [x] Verify navigation works with gesture navigation on mobile
        [Source: architecture/8-frontend-architecture.md - mobile-optimized responsive design]

- [x] **Task 7: Write tests for navigation component** (AC: all)
  - [x] Unit tests for BottomNav component
  - [x] Test active state detection logic
  - [x] Test visibility logic for different routes
  - [x] Integration tests for navigation behavior

## Dev Notes

### Previous Story Context

No directly related previous stories for navigation implementation. Stories 3.1-3.7 focused on individual Toolkit features.

### Technical Stack

- Framework: Next.js 15.0.0 with App Router
- UI Components: shadcn/ui with Tailwind CSS v4
- Styling: Tailwind CSS with CSS variables for theming
- State: usePathname hook from Next.js for route detection
  [Source: architecture/2-tech-stack.md]

### Component Architecture

- Navigation component already exists at `/components/features/shared/BottomNav.tsx`
- Uses Lucide icons (Home, Settings)
- Implements active state detection with `usePathname()`
- Fixed positioning at bottom with z-50 for proper layering
  [Source: components/features/shared/BottomNav.tsx]

### Route Structure

```
/app/
├── /(app)/          # Protected routes - needs navigation
│   ├── /toolkit/    # My Toolkit hub
│   ├── /roadmap/    # Roadmap view
│   ├── /learn/      # No navigation (focused screen)
│   ├── /plan/       # No navigation (focused screen)
│   └── /reflect/    # No navigation (focused screen)
├── /(auth)/         # Public auth routes - no navigation
│   └── /login/
```

[Source: architecture/10-unified-project-structure.md]

### Frontend Specification Notes

- Bottom navigation serves as primary menu for V1
- Contains icon-based links to "My Toolkit" and "Settings"
- Minimalist and unobtrusive design
- Persistent app-level navigation except on focused screens
- Mobile, Tablet, and Desktop all use bottom tabs pattern
  [Source: frontend-spec.md#bottom-navigation]

### Coding Standards

- Components use PascalCase: `BottomNav.tsx`
- Hooks use camelCase with 'use' prefix: `usePathname`
- Follow functional programming style (pure functions, immutability)
- Use `cn()` utility for combining Tailwind classes
- Database fields use snake_case (not applicable here)
  [Source: architecture/12-coding-standards.md]

### Component Template Pattern

All components should follow the standard template:

```tsx
import * as React from "react";
import { cn } from "@/lib/utils";

interface ComponentProps extends React.HTMLAttributes<HTMLDivElement> {
  // props
}

const Component = React.forwardRef<HTMLDivElement, ComponentProps>(
  ({ className, ...props }, ref) => {
    // component logic
    return (
      <div className={cn("base-classes", className)} ref={ref} {...props}>
        {/* content */}
      </div>
    );
  }
);
Component.displayName = "Component";

export { Component };
```

[Source: architecture/8-frontend-architecture.md#component-template]

### Testing Standards

- Test files location: `/tests/unit/` for unit tests, `/tests/integration/` for integration tests
- Use Vitest for unit and integration testing
- Test file naming: `*.test.ts` or `*.test.tsx`
- Focus on testing navigation visibility logic and active state detection
- Ensure tests cover all route scenarios
  [Source: architecture/2-tech-stack.md - Vitest for testing]

## Change Log

| Date       | Version | Description   | Author             |
| ---------- | ------- | ------------- | ------------------ |
| 2025-08-06 | 1.0     | Initial draft | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

claude-opus-4-1-20250805

### Debug Log References

- Enhanced BottomNav component with proper active state detection and animations
- Created navigation visibility logic helper functions
- Implemented keyboard visibility detection for mobile devices
- Added safe area support for iOS devices
- All tests passing (29 tests)
- Linting and type checking completed successfully

### Completion Notes List

1. Enhanced existing BottomNav component with improved styling, animations, and active state detection
2. Created navigation visibility logic to hide/show nav based on current route
3. Implemented app layout with conditional navigation rendering
4. Added keyboard visibility detection to hide nav when mobile keyboard appears
5. Added safe area padding support for iOS devices
6. Implemented comprehensive test coverage (unit, integration)
7. All acceptance criteria met and validated

### File List

**Modified:**

- `/components/features/shared/BottomNav.tsx` - Enhanced navigation component
- `/app/globals.css` - Added safe area CSS utilities

**Created:**

- `/lib/navigation/visibility.ts` - Navigation visibility helper functions
- `/app/(app)/layout.tsx` - App route group layout with navigation
- `/lib/hooks/useKeyboardVisibility.ts` - Keyboard visibility detection hook
- `/tests/unit/BottomNav.test.tsx` - Unit tests for BottomNav component
- `/tests/unit/navigation-visibility.test.ts` - Unit tests for visibility logic
- `/tests/integration/navigation.test.tsx` - Integration tests for navigation

## QA Results

_To be populated by QA agent_
