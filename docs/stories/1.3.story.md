# Story 1.3: Roadmap Visualization Screen

## Status

Approved

## Story

**As a** user who just created a roadmap
**I want** to see my personalized learning path displayed visually
**So that** I understand my journey and feel motivated to start learning

## Acceptance Criteria

1. Roadmap view displays immediately after generation (no additional loading)
2. Visual journey shows all 5-7 steps with clear progression path
3. First step is unlocked and clickable, subsequent steps are locked/blurred
4. Each step shows mental model/bias name and brief description
5. Progress indicators show current position in journey
6. Mobile-responsive design with vertical layout on small screens
7. Smooth animations when transitioning from generation screen
8. "Start Learning" CTA button on first available step

## Tasks / Subtasks

- [ ] Task 1: Write integration tests using TDD approach (AC: 1, 2, 3, 4, 5, 6, 7, 8)
  - [ ] Create test file at `/app/(app)/roadmap/__tests__/roadmap.test.tsx`
  - [ ] Write test for authenticated access only
  - [ ] Write test for loading active roadmap data
  - [ ] Write test for displaying all roadmap steps in order
  - [ ] Write test for first step being unlocked/clickable
  - [ ] Write test for subsequent steps being locked/blurred
  - [ ] Write test for progress indicators
  - [ ] Write test for mobile responsive layout
  - [ ] Write test for "Start Learning" CTA functionality
  - [ ] Mock Supabase data fetching (for unit tests)
  - [ ] Consider integration tests with real API
- [ ] Task 2: Set up roadmap route and data fetching (AC: 1)
  - [ ] Create `/app/(app)/roadmap/` directory structure
  - [ ] Create `page.tsx` with authentication check
  - [ ] Implement data fetching for active roadmap:
    - Use Supabase client to query active roadmap
    - Include nested roadmap steps with knowledge content
    - Handle case where no active roadmap exists
    - Note: Can use real data from API - no mocks needed
  - [ ] Set up loading and error states
  - [ ] Add redirect to `/new-roadmap` if no active roadmap
- [ ] Task 3: Create RoadmapView component (AC: 2, 5, 6, 7)
  - [ ] Create `/components/features/roadmap/RoadmapView.tsx`
  - [ ] Implement container with max-width and padding
  - [ ] Add roadmap title and goal description header
  - [ ] Create progress bar showing overall completion
  - [ ] Implement fade-in animation on mount
  - [ ] Add responsive grid/flex layout:
    - Desktop: Horizontal flow with connecting lines
    - Mobile: Vertical stack
- [ ] Task 4: Build RoadmapStep component (AC: 3, 4, 8)
  - [ ] Create `/components/features/roadmap/RoadmapStep.tsx`
  - [ ] Props: step data, isAvailable, isCompleted, index
  - [ ] Implement card design with:
    - Icon/number indicator
    - Title (mental model/bias name)
    - Brief description (summary field)
    - Status badge (locked/available/completed)
  - [ ] Add visual states:
    - Available: Full color, clickable, hover effects
    - Locked: Grayscale, blur effect, not clickable
    - Completed: Check mark, muted colors
  - [ ] "Start Learning" button on first available step
  - [ ] Click handler to navigate to learning screen
- [ ] Task 5: Create RoadmapConnector component (AC: 2, 6)
  - [ ] Create `/components/features/roadmap/RoadmapConnector.tsx`
  - [ ] Draw connecting lines between steps:
    - Solid line for completed connections
    - Dashed line for upcoming connections
  - [ ] Responsive behavior:
    - Horizontal lines on desktop
    - Hidden on mobile (use spacing instead)
  - [ ] Animate line drawing on initial load
- [ ] Task 6: Implement state management (AC: 1, 3, 5)
  - [ ] Create `/lib/stores/roadmap-store.ts` using Zustand
  - [ ] Define RoadmapViewState interface:
    - activeRoadmap: Roadmap | null
    - currentStepIndex: number
    - isLoading: boolean
  - [ ] Add actions:
    - fetchActiveRoadmap()
    - setCurrentStep()
    - markStepCompleted()
  - [ ] Handle state persistence for offline support
- [ ] Task 7: Add animations and transitions (AC: 7)
  - [ ] Implement page transition from new-roadmap to roadmap view
  - [ ] Add stagger animation for steps appearing
  - [ ] Create smooth scroll to current step on load
  - [ ] Add subtle hover animations on interactive elements
  - [ ] Ensure animations respect prefers-reduced-motion
- [ ] Task 8: Polish and error handling (AC: 1, 2)
  - [ ] Add loading skeleton while data fetches
  - [ ] Handle error states gracefully:
    - No active roadmap: redirect to new-roadmap
    - Failed to load: show retry button
  - [ ] Add breadcrumb navigation
  - [ ] Implement "Back to Toolkit" link (for future use)
- [ ] Task 9: Verify all tests pass (AC: 1, 2, 3, 4, 5, 6, 7, 8)
  - [ ] Run test suite and ensure 100% pass rate
  - [ ] Test on multiple screen sizes
  - [ ] Verify animations work smoothly
  - [ ] Check accessibility with screen readers

## Dev Notes

### Important Backend Context (Updated 2025-08-01)

The backend infrastructure for this feature is **fully implemented**:

- POST /api/roadmaps endpoint is complete and working
- Real knowledge_content database with 125+ mental models/biases
- All content has vector embeddings for semantic search
- API returns properly structured Roadmap objects with nested steps
- No mocks or placeholders needed - build directly against real API

### Route Structure

The roadmap view is placed in the authenticated route group:

```
/app/(app)/roadmap/
├── page.tsx           # Main roadmap view page
└── __tests__/         # Integration tests
    └── roadmap.test.tsx
```

[Source: architecture/8-frontend-architecture.md#Routing Structure]

### Component Architecture

Follow established component patterns:

- Use `React.forwardRef` for all components
- TypeScript interfaces extending HTML attributes
- Use `cn()` utility for Tailwind classes
- Components in `/components/features/roadmap/`

[Source: architecture/8-frontend-architecture.md#Component Organization]

### Data Fetching Pattern

Fetch active roadmap with nested data:

```typescript
const roadmap = await supabase
  .from("roadmaps")
  .select(
    `
    *,
    steps:roadmap_steps(
      *,
      knowledge_content(*)
    )
  `
  )
  .eq("user_id", userId)
  .eq("status", "active")
  .single();
```

[Source: architecture/6-core-workflows.md#Workflow 1]

### UI Design from Prototype

Key elements from the design:

- Clean, minimal interface with focus on content
- Card-based design for each step
- Visual progression indicators
- Green accent color for CTAs
- Blur effect on locked content

### State Management

Using Zustand for roadmap state:

- Fetches and caches active roadmap
- Tracks current user position
- Updates as user progresses

[Source: architecture/8-frontend-architecture.md#State Management]

### Responsive Design

- Desktop: Horizontal journey with connecting lines
- Tablet: Compressed horizontal or vertical based on aspect ratio
- Mobile: Vertical stack with no connecting lines
- Use Tailwind breakpoints: sm, md, lg

[Source: architecture/2-tech-stack.md#Frontend Stack]

### Animation Guidelines

- Use Framer Motion for complex animations
- CSS transitions for simple hover states
- Respect user's motion preferences
- Keep animations under 300ms for responsiveness

### Previous Story Context

From Story 1.2:

- Roadmap generation returns Roadmap object with nested steps
- Each step has orderIndex for proper sequencing
- First step status is 'available', others are 'locked'
- **Important Update (2025-08-01)**: The API endpoint is fully implemented with real data
  - No mocks needed - can fetch real roadmaps immediately
  - Knowledge content includes 125+ mental models/biases with full details
  - API returns properly structured data ready for visualization

This visualization displays the data structure created by the API.

### Accessibility Considerations

- Semantic HTML with proper heading hierarchy
- ARIA labels for interactive elements
- Keyboard navigation support
- Screen reader announcements for state changes
- Sufficient color contrast ratios

### Testing

Following TDD approach:

- Test file: `/app/(app)/roadmap/__tests__/roadmap.test.tsx`
- Mock roadmap data with various states (for unit tests)
- **Can also test against real API** for integration testing
- Test responsive behavior
- Verify animations and transitions
- Check accessibility compliance

[Source: architecture/11-testing-strategy.md#Testing Philosophy]

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-08-01 | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

_To be populated by Dev Agent_

### Debug Log References

_To be populated by Dev Agent_

### Completion Notes List

_To be populated by Dev Agent_

### File List

_To be populated by Dev Agent_

## QA Results

_To be populated by QA Agent_
